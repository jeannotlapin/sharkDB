<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Jessica's sharks DB</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
	.tableHeader {
		background-color : #3db5d8;
	}
    </style>
</head>
<body>
  <nav class="navbar navbar-default navbar-static-top">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Shark Database</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" ><span id="currentCountry">Countries</span><span class="caret"></span></a>
	<ul class="dropdown-menu" role="menu" id="countryDropdown"></ul>
        </li>
        <li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" ><span id="currentSpecies">Species</span><span class="caret"></span></a>
	<ul class="dropdown-menu" role="menu" id="speciesDropdown"></ul>
        </li>
        <li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" ><span id="currentRFMO">RFMO</span><span class="caret"></span></a>
	<ul class="dropdown-menu" role="menu" id="RFMODropdown"></ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container -->
  </nav>
  <div class="container" id="mainContainer" style="display:none;">
	  <h1 id="displayTitle"></h1>
	  <div class="bs-doc-section">
		  <div class="row">
			  <div class="col-lg-9">
				  <div class="panel panel-info">
					  <table class="table table-striped table-hover" id="displayTable"></table>
				  </div>
			  </div>
			  <div class="col-lg-3">
				  <div class="panel panel-info">
					<div class="panel-heading"><h3 class="panel-title" id="sidePanelTitle"></h3></div>
					<div class="panel-body" id="sidePanelBody"></div>
				  </div>
			  </div>
		  </div>
	  </div>
  </div><!-- container -->

   <!-- Bootstrap core JavaScript
   ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>
</body>
<script>
var countryList = new Array();
var speciesList = new Object();
var RFMOList = new Object();
var countryInfoList = new Array();

queue(2)
	.defer(d3.csv, "data/countryList.csv", function (d) {
			if (+d.isonumcode != 0 && !isNaN(d.isonumcode)) { /* skip invalid country code */
				if (!(+d.isonumcode in countryList)) countryList[+d.isonumcode] = new Array();
				countryList[+d.isonumcode].push({type: d.type, title: d.title, description: d.description, url: d.symbol, year: d.year});
				}
			}
	      )
	.defer(d3.csv, "data/RFMOList.csv", function (d) {
			/* populate RFMOList */
			if (!(d.RFMO in RFMOList)) RFMOList[d.RFMO] = new Array();
			RFMOList[d.RFMO].push({type: d.type, measure: d.measure, species: d.species, title: d.title, description: d.description, url: d.symbol, year: d.year});
			/* populate SpeciesList */
			if (!(d.species in speciesList)) speciesList[d.species] = new Array();
			speciesList[d.species].push({type: d.type, measure: d.measure, RFMO: d.RFMO, title: d.title, description: d.description, url: d.symbol, year: d.year});
			}
	      )
	.defer(d3.csv, "data/countryMembership.csv", function (d) {
			if (+d.isonumcode != 0 && !isNaN(d.isonumcode)) { /* skip invalid country code */
				countryInfoList[+d.isonumcode] = {name: d.name, iso2: d.isocode2, iso3: d.isocode3, rfmo: d.RFMO.split(',')};
				}
			}
	      )
	.awaitAll(ready);

/* sort by most recent to less recent and alphabetical order of title for same year docs */
function yearSort(a,b) {
	 if (+a.year>+b.year) return -1;
	 if (+a.year<+b.year) return 1;
	 if (a.title>b.title) return 1;
	 return -1;
}

function displayCountry(country) {

	$('#mainContainer').hide();
	/* set selector head to current value and reset other selectors */
	document.getElementById("currentCountry").textContent = countryInfoList[country].name;
	document.getElementById("currentSpecies").textContent = "Species";
	document.getElementById("currentRFMO").textContent = "RFMO";

	/* display document list */
	var tableInnerHTML = '<thead><tr class="tableHeader"><th>Type</th><th>Title</th><th>Description</th><th>Year</th><th>link</th></tr></thead><tbody>';
	countryList[country].sort(yearSort).forEach(function(d){ tableInnerHTML = tableInnerHTML + "<tr><td>"+d.type+"</td><td>"+d.title+"</td><td>"+d.description+"</td><td>"+d.year+"</td><td>"+d.url+"</td></tr>";});
	tableInnerHTML = tableInnerHTML + "</tbody>";
	document.getElementById("displayTable").innerHTML = tableInnerHTML;
	document.getElementById("displayTitle").textContent = countryInfoList[country].name;

	/* get the country membership */
	document.getElementById("sidePanelTitle").textContent = "Member of";
	var sidePanelInnerHTML = '';
	countryInfoList[country].rfmo.forEach(function(d){sidePanelInnerHTML = sidePanelInnerHTML + "<div>"+d+"</div>"});
	document.getElementById("sidePanelBody").innerHTML = sidePanelInnerHTML;

	$('#mainContainer').show();
}

function displaySpecies(species) {

	$('#mainContainer').hide();
	/* set selector head to current value and reset other selectors */
	document.getElementById("currentCountry").textContent = "Country";
	document.getElementById("currentSpecies").textContent = species;
	document.getElementById("currentRFMO").textContent = "RFMO";

	/* display document list */
	var tableInnerHTML = '<thead><tr class="tableHeader"><th>Type</th><th>Title</th><th>Description</th><th>Year</th><th>link</th></tr></thead><tbody>';
	speciesList[species].sort(yearSort).forEach(function(d){ tableInnerHTML = tableInnerHTML + "<tr><td>"+d.type+"</td><td>"+d.title+"</td><td>"+d.description+"</td><td>"+d.year+"</td><td>"+d.url+"</td></tr>";});
	tableInnerHTML = tableInnerHTML + "</tbody>";
	document.getElementById("displayTable").innerHTML = tableInnerHTML;
	document.getElementById("displayTitle").textContent = species;
	$('#mainContainer').show();

	/* get fish information */
	document.getElementById("sidePanelTitle").textContent = "Distribution";
	document.getElementById("sidePanelBody").innerHTML = "<div>Insert here map of distribution</div>";
}

function displayRFMO(RFMO) {

	$('#mainContainer').hide();
	/* set selector head to current value and reset other selectors */
	document.getElementById("currentCountry").textContent = "Country";
	document.getElementById("currentSpecies").textContent = "Species";
	document.getElementById("currentRFMO").textContent = RFMO;

	/* display document list */
	var tableInnerHTML = '<thead><tr class="tableHeader"><th>Type</th><th>Title</th><th>Description</th><th>Year</th><th>link</th></tr></thead><tbody>';
	RFMOList[RFMO].sort(yearSort).forEach(function(d){ tableInnerHTML = tableInnerHTML + "<tr><td>"+d.type+"</td><td>"+d.title+"</td><td>"+d.description+"</td><td>"+d.year+"</td><td>"+d.url+"</td></tr>";});
	tableInnerHTML = tableInnerHTML + "</tbody>";
	document.getElementById("displayTable").innerHTML = tableInnerHTML;
	document.getElementById("displayTitle").textContent = RFMO;

	/* get members */
	document.getElementById("sidePanelTitle").textContent = "Members";
	var sidePanelInnerHTML = '';
	countryInfoList.sort(function (a,b) { if (a.name<b.name) return -1; return 1}).forEach(function(d){if ($.inArray(RFMO, d.rfmo) != -1) {sidePanelInnerHTML = sidePanelInnerHTML + "<div>"+d.name+"</div>"}});
	document.getElementById("sidePanelBody").innerHTML = sidePanelInnerHTML;

	$('#mainContainer').show();
}


function ready(error, results) {
	console.log("country List "); console.log(countryList);
	console.log("RFMO List "); console.log(RFMOList);
	console.log("species List "); console.log(speciesList);
	console.log("country Info  List "); console.log(countryInfoList);
	/* create dropdown from keys of the lists */
	var dropdownInnerHTML = '';
	Object.keys(countryList).sort(function (a,b) {if (countryInfoList[a].name < countryInfoList[b].name) return -1; return 1;}).forEach(function(d) {dropdownInnerHTML = dropdownInnerHTML + "<li onclick='displayCountry("+(+d)+")'><a href='#'>"+countryInfoList[d].name+"</a></li>";});
	document.getElementById("countryDropdown").innerHTML = dropdownInnerHTML;
	dropdownInnerHTML = '';
	Object.keys(speciesList).sort().forEach(function(d) {dropdownInnerHTML = dropdownInnerHTML + "<li onclick='displaySpecies(\""+d+"\")'><a href='#'>"+d+"</a></li>";});
	document.getElementById("speciesDropdown").innerHTML = dropdownInnerHTML;
	dropdownInnerHTML = '';
	Object.keys(RFMOList).sort().forEach(function(d) {dropdownInnerHTML = dropdownInnerHTML + "<li onclick='displayRFMO(\""+d+"\")'><a href='#'>"+d+"</a></li>";});
	document.getElementById("RFMODropdown").innerHTML = dropdownInnerHTML;
}

</script>
